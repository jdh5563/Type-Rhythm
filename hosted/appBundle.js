(()=>{var e={982:e=>{let t;const a=e=>{t=e},n=io();let r,i,c,o,s,l,d;const h=[],m=async e=>{i.save(),i.font="16px Arial";let a=e.target.value;const n=i.measureText(c.substring(0,a.length)),s=n.width;if(i.clearRect(0,.75*r.height-n.fontBoundingBoxAscent,r.width,r.height),c.substring(0,a.length)===a){if(u(i,c,10,.75*r.height,20,r.width-20,a.length,s),a.length===c.length){d=Date.now()-l,e.target.oninput=e=>{};const a=await fetch("/getToken"),n=await a.json(),c=await fetch("/getStanding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raceCode:t.raceCode,_csrf:n.csrfToken})}),s=await c.json(),h=`You got ${s.standing+g(String(s.standing))} place!`,m=`You type ${Math.round(o/(d/6e4))} wpm!`;i.save(),i.font="48px Arial",u(i,h,.15*r.width,.5*r.height,60,.8*r.width),u(i,m,.15*r.width,.5*r.height+60,60,.8*r.width),i.restore()}}else u(i,c,10,.75*r.height,20,r.width-20,a.length-1,s),a=a.substring(0,a.length-1),e.target.value=a;i.restore()},u=(e,t,a,n,r,i,c=0,o=0)=>{if((i=i||0)<=0)e.fillText(t,a,n);else{for(let s=1;s<=t.length;s++){const l=t.substring(0,s);if(e.measureText(l).width>i)return void(s<=c?(e.save(),e.fillStyle="green",e.fillText(t.substring(0,s),a,n),e.restore(),u(e,t.substring(s),a,n+r,r,i,c-s,o)):(e.save(),e.fillStyle="green",e.fillText(t.substring(0,c),a,n),e.restore(),e.fillText(t.substring(c,s),a+e.measureText(t.substring(0,c)).width,n),u(e,t.substring(s),a,n+r,r,i)))}c>0?(e.save(),e.fillStyle="green",e.fillText(t.substring(0,c),a,n),e.restore(),e.fillText(t.substring(c),a+e.measureText(t.substring(0,c)).width,n)):e.fillText(t,a,n)}},g=e=>"1"===e[e.length-1]?"st":"2"===e[e.length-1]?"nd":"3"===e[e.length-1]?"rd":"th";e.exports={init:e=>{r=document.getElementById("canvas"),i=r.getContext("2d"),r.width=.6*window.innerWidth,r.height=.5*r.clientWidth,i.save(),i.fillStyle="white",i.fillRect(0,0,r.clientWidth,r.height),i.restore(),c=e,o=c.split(" ").length,i.save(),i.font="16px Arial",u(i,e,10,.75*r.height,20,r.width-20),i.restore();const a=Object.keys(t.players);for(let e=0;e<a.length;e++)h.push(new Image),h[e].onload=()=>{i.drawImage(h[e],0,e*r.height/a.length,50,50)},h[e].src=t.players[a[e]].skin;s=document.getElementById("user-input"),s.oninput=e=>e.target.value="",window.addEventListener("resize",(()=>{r.width=.6*window.innerWidth,r.height=.5*r.clientWidth,i.save(),i.font="16px Arial",u(i,e,10,.75*r.height,20,r.width-20),i.restore();for(let e=0;e<a.length;e++)h.push(new Image),h[e].onload=()=>{i.drawImage(h[e],0,e*r.height/a.length,50,50)},h[e].src=t.players[a[e]].skin})),window.setTimeout((()=>{window.setTimeout((()=>{window.setTimeout((()=>{window.setTimeout((()=>{const e=i.measureText("1");i.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),i.restore(),s.oninput=m,l=Date.now()}),1e3);const e=i.measureText("2");i.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),u(i,"1",.5*r.width,.5*r.height,20,r.width-20)}),1e3);const e=i.measureText("3");i.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),u(i,"2",.5*r.width,.5*r.height,20,r.width-20)}),1e3),i.save(),i.font="72px Arial",u(i,"3",.5*r.width,.5*r.height,20,r.width-20)}),1e3)},createLobby:async e=>{const a=await fetch("/getUsername"),r=await a.json().then((e=>e)),i=await fetch("/getCar"),c=await i.json().then((e=>e)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let s="";for(let e=0;e<4;e++)s+=o[Math.floor(Math.random()*o.length)];const l={username:r.username,skin:c.skin,raceCode:s,_csrf:e},d=await fetch("/createLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return t=await d.json(),n.emit("createdLobby",t.raceCode),t},joinLobby:async(e,r)=>{const i=await fetch("/getUsername"),c=await i.json().then((e=>e)),o=await fetch("/getCar"),s=await o.json().then((e=>e)),l={username:c.username,skin:s.skin,raceCode:e,_csrf:r},d=await fetch("/joinLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return t=await d.json(),a(t),n.emit("changedLobby",t,!0),t},leaveLobby:async e=>{const a=await fetch("/getUsername"),r={username:(await a.json().then((e=>e))).username,raceCode:t.raceCode,_csrf:e},i=await fetch("/leaveLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});t=await i.json(),n.emit("changedLobby",t,!1),t={}},getRaceCode:()=>t.raceCode,setLobby:a,socket:n}}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}(()=>{const e=a(982);e.socket.on("changedLobby",(async t=>{t.error?ReactDOM.render(React.createElement(d,{error:t.error})):(e.setLobby(t),c(t.players,t.raceCode))})),e.socket.on("startedRace",(async t=>{await ReactDOM.render(React.createElement(l,null),document.getElementById("game-content")),e.init(t)}));const t=async t=>{t.preventDefault();const a=await e.createLobby(t.target.querySelector("#_csrf").value);c(a.players,a.raceCode)},n=async t=>{t.preventDefault();const a=await e.joinLobby(t.target.querySelector("#raceCode").value,t.target.querySelector("#_csrf").value);a.error?ReactDOM.render(React.createElement(d,{error:a.error}),document.getElementById("game-content")):c(a.players,a.raceCode)},r=async t=>{t.preventDefault(),await e.leaveLobby(t.target.querySelector("#_csrf").value),ReactDOM.render(React.createElement(o,{csrf:t.target.querySelector("#_csrf").value}),document.getElementById("game-content"))},i=async t=>{t.preventDefault();const a=await fetch("/generateParagraph"),n=(await a.json()).paragraph;await ReactDOM.render(React.createElement(l,null),document.getElementById("game-content")),e.socket.emit("startedRace",n,e.getRaceCode())},c=async(e,t)=>{const a=await fetch("/getToken"),n=await a.json();ReactDOM.render(React.createElement(s,{players:e,raceCode:t,csrf:n.csrfToken}),document.getElementById("game-content"));const r=await fetch("/getUsername");e[(await r.json().then((e=>e))).username].owner||(document.getElementById("startButton").type="hidden")},o=e=>React.createElement("div",null,React.createElement("h1",null,"Join a Race!"),React.createElement("form",{id:"createForm",name:"createForm",onSubmit:t,action:"/createRace",method:"POST"},React.createElement("div",null,React.createElement("input",{className:"raceSubmit",type:"submit",value:"Create Race"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf})),React.createElement("form",{id:"joinForm",name:"joinForm",onSubmit:n,action:"/joinRace",method:"POST"},React.createElement("div",null,React.createElement("input",{id:"raceCode",type:"text",placeholder:"Race Code"}),React.createElement("input",{className:"raceSubmit",type:"submit",value:"Join Race"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf}))),s=e=>{const t=[];for(let a of Object.keys(e.players))t.push(React.createElement("div",{key:a},React.createElement("h3",null,e.players[a].username)));return React.createElement("div",null,t,React.createElement("div",null,"Race Code: ",e.raceCode),React.createElement("form",{id:"raceForm",name:"raceForm",onSubmit:i,action:"/startRace",method:"POST"},React.createElement("input",{className:"raceSubmit",id:"startButton",type:"submit",value:"Start Race"})),React.createElement("form",{id:"leaveForm",name:"leaveForm",onSubmit:r,action:"/leaveRace",method:"POST"},React.createElement("input",{className:"raceSubmit",id:"leaveButton",type:"submit",value:"Leave Lobby"}),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf})))},l=e=>React.createElement("div",null,React.createElement("div",null,React.createElement("canvas",{id:"canvas"})),React.createElement("div",null,React.createElement("input",{id:"user-input",type:"text",placeholder:"Type here!"}))),d=e=>React.createElement("h1",null,e.error);window.onload=async()=>{const e=await fetch("/getToken"),t=await e.json(),a=await fetch("/premium").then((e=>e.json())).then((e=>e.premium)),n=document.querySelector("nav-bar").shadowRoot.lastElementChild.lastElementChild.firstElementChild.lastElementChild;a?n.textContent="Premium Member!":n.addEventListener("click",(async e=>(e.preventDefault(),await fetch("/premium",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_csrf:t.csrfToken})}),e.target.textContent="Premium Member!",!1))),ReactDOM.render(React.createElement(o,{csrf:t.csrfToken}),document.getElementById("game-content"))}})()})();