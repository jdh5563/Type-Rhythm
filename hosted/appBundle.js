(()=>{var e={982:e=>{let t;const n=e=>{t=e},a=io();let r,c,o,i;const s=[],l=e=>{c.save(),c.font="16px Arial";let t=e.target.value;const n=c.measureText(o.substring(0,t.length)),a=n.width;c.clearRect(0,.75*r.height-n.fontBoundingBoxAscent,r.width,r.height),o.substring(0,t.length)===t?d(c,o,10,.75*r.height,20,r.width-20,a,t.length):(d(c,o,10,.75*r.height,20,r.width-20,a,t.length-1),t=t.substring(0,t.length-1),e.target.value=t),c.restore()},d=(e,t,n,a,r,c,o=0,i=0)=>{if((c=c||0)<=0)e.fillText(t,n,a);else{for(let s=1;s<=t.length;s++){const l=t.substring(0,s);if(e.measureText(l).width>c)return void(s-1<=i?(e.save(),e.fillStyle="green",e.fillText(t.substring(0,s-1),n,a),d(e,t.substring(s-1),n,a+r,r,c,i-(s-1)),e.restore()):(e.save(),e.fillStyle="green",e.fillText(t.substring(0,i),n,a),e.restore(),e.fillText(t.substring(i,s-1),n+o,a),d(e,t.substring(s-1),n,a+r,r,c)))}i>0?(e.save(),e.fillStyle="green",e.fillText(t.substring(0,i),n,a),e.restore(),e.fillText(t.substring(i),n,a)):e.fillText(t,n,a)}};e.exports={init:e=>{r=document.getElementById("canvas"),c=r.getContext("2d"),r.width=.6*window.innerWidth,r.height=.69*r.clientWidth,c.save(),c.fillStyle="white",c.fillRect(0,0,r.clientWidth,r.height),c.restore(),o=e,c.save(),c.font="16px Arial",d(c,e,10,.75*r.height,20,r.width-20),c.restore();const n=Object.keys(t.players);for(let e=0;e<n.length;e++)s.push(new Image),s[e].onload=()=>{c.drawImage(s[e],0,e*r.height/n.length,50,50)},s[e].src=t.players[n[e]].skin;i=document.getElementById("user-input"),i.oninput=e=>e.target.value="",window.addEventListener("resize",(()=>{r.width=.6*window.innerWidth,r.height=.69*r.clientWidth,c.save(),c.font="16px Arial",d(c,e,10,.75*r.height,20,r.width-20),c.restore();for(let e=0;e<n.length;e++)s.push(new Image),s[e].onload=()=>{c.drawImage(s[e],0,e*r.height/n.length,50,50)},s[e].src=t.players[n[e]].skin})),window.setTimeout((()=>{window.setTimeout((()=>{window.setTimeout((()=>{window.setTimeout((()=>{const e=c.measureText("1");c.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),c.restore(),i.oninput=l}),1e3);const e=c.measureText("2");c.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),d(c,"1",.5*r.width,.5*r.height,20,r.width-20)}),1e3);const e=c.measureText("3");c.clearRect(.5*r.width,.5*r.height+10,e.width,-1*(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent)),d(c,"2",.5*r.width,.5*r.height,20,r.width-20)}),1e3),c.save(),c.font="72px Arial",d(c,"3",.5*r.width,.5*r.height,20,r.width-20)}),1e3)},createLobby:async e=>{const n=await fetch("/getUsername"),r=await n.json().then((e=>e)),c=await fetch("/getCar"),o=await c.json().then((e=>e)),i="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let s="";for(let e=0;e<4;e++)s+=i[Math.floor(Math.random()*i.length)];const l={username:r.username,skin:o.skin,raceCode:s,_csrf:e},d=await fetch("/createLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return t=await d.json(),a.emit("createdLobby",t.raceCode),t},joinLobby:async(e,r)=>{const c=await fetch("/getUsername"),o=await c.json().then((e=>e)),i=await fetch("/getCar"),s=await i.json().then((e=>e)),l={username:o.username,skin:s.skin,raceCode:e,_csrf:r},d=await fetch("/joinLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return t=await d.json(),n(t),a.emit("changedLobby",t,!0),t},leaveLobby:async e=>{const n=await fetch("/getUsername"),r={username:(await n.json().then((e=>e))).username,raceCode:t.raceCode,_csrf:e},c=await fetch("/leaveLobby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});t=await c.json(),a.emit("changedLobby",t,!1),t={}},getRaceCode:()=>t.raceCode,setLobby:n,socket:a}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var c=t[a]={exports:{}};return e[a](c,c.exports,n),c.exports}(()=>{const e=n(982);e.socket.on("changedLobby",(async t=>{if(t.error){const e=e=>React.createElement("h1",null,e.error);ReactDOM.render(React.createElement(e,{error:t.error}))}else e.setLobby(t),o(t.players,t.raceCode)})),e.socket.on("startedRace",(async t=>{await ReactDOM.render(React.createElement(l,null),document.getElementById("game-content")),e.init(t)}));const t=async t=>{t.preventDefault();const n=await e.createLobby(t.target.querySelector("#_csrf").value);o(n.players,n.raceCode)},a=async t=>{t.preventDefault();const n=await e.joinLobby(t.target.querySelector("#raceCode").value,t.target.querySelector("#_csrf").value);n.error?ReactDOM.render(React.createElement(Error,{error:n.error})):o(n.players,n.raceCode)},r=async t=>{t.preventDefault(),await e.leaveLobby(t.target.querySelector("#_csrf").value),ReactDOM.render(React.createElement(i,{csrf:t.target.querySelector("#_csrf").value}),document.getElementById("game-content"))},c=async t=>{t.preventDefault();const n=await fetch("/generateParagraph"),a=(await n.json()).paragraph;await ReactDOM.render(React.createElement(l,null),document.getElementById("game-content")),e.socket.emit("startedRace",a,e.getRaceCode())},o=async(e,t)=>{const n=await fetch("/getToken"),a=await n.json();ReactDOM.render(React.createElement(s,{players:e,raceCode:t,csrf:a.csrfToken}),document.getElementById("game-content"));const r=await fetch("/getUsername");e[(await r.json().then((e=>e))).username].owner||(document.getElementById("startButton").type="hidden")},i=e=>React.createElement("div",null,React.createElement("h1",null,"Join a Race!"),React.createElement("form",{id:"createForm",name:"createForm",onSubmit:t,action:"/createRace",method:"POST"},React.createElement("div",null,React.createElement("input",{type:"submit",value:"Create Race"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf})),React.createElement("form",{id:"joinForm",name:"joinForm",onSubmit:a,action:"/joinRace",method:"POST"},React.createElement("div",null,React.createElement("input",{id:"raceCode",type:"text",placeholder:"Race Code"}),React.createElement("input",{type:"submit",value:"Join Race"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf}))),s=e=>{const t=[];for(let n of Object.keys(e.players))t.push(React.createElement("div",{key:n},React.createElement("h3",null,e.players[n].username)));return React.createElement("div",null,t,React.createElement("div",null,"Race Code: ",e.raceCode),React.createElement("form",{id:"raceForm",name:"raceForm",onSubmit:c,action:"/startRace",method:"POST"},React.createElement("input",{id:"startButton",type:"submit",value:"Start Race"})),React.createElement("form",{id:"leaveForm",name:"leaveForm",onSubmit:r,action:"/leaveRace",method:"POST"},React.createElement("input",{id:"leaveButton",type:"submit",value:"Leave Lobby"}),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:e.csrf})))},l=e=>React.createElement("div",null,React.createElement("div",null,React.createElement("canvas",{id:"canvas"})),React.createElement("div",null,React.createElement("input",{id:"user-input",type:"text",placeholder:"Type here!"})));window.onload=async()=>{const e=await fetch("/getToken"),t=await e.json(),n=await fetch("/premium").then((e=>e.json())).then((e=>e.premium)),a=document.getElementById("premiumButton");n?a.textContent="Premium Member!":a.addEventListener("click",(async e=>(e.preventDefault(),await fetch("/premium",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_csrf:t.csrfToken})}),e.target.textContent="Premium Member!",!1))),ReactDOM.render(React.createElement(i,{csrf:t.csrfToken}),document.getElementById("game-content"))}})()})();